@model List<ExpenseTracker.Models.BudgetStatus>

@{
    ViewData["Title"] = "Budgets";
    var now = DateTime.Now;
}

<div class="flex justify-between items-center mb-4">
    <div>
        <h1 class="mb-1">Budget Management</h1>
        <p style="color: var(--text-secondary);">Track your spending against monthly budgets</p>
    </div>
    <a href="/Budgets/Create" class="btn btn-primary">
        <i class="fas fa-plus"></i>
        Create Budget
    </a>
</div>

@if (Model.Any())
{
    <div class="grid grid-cols-2 gap-md">
        @foreach (var budget in Model)
        {
            <div class="card">
                <div class="flex justify-between items-center mb-3">
                    <div class="flex items-center gap-md">
                        <div style="width: 40px; height: 40px; border-radius: var(--radius-md); background: @budget.CategoryColor; display: flex; align-items: center; justify-content: center; color: white;">
                            <i class="fas fa-chart-pie"></i>
                        </div>
                        <div>
                            <h3 style="margin: 0;">@budget.CategoryName</h3>
                            <small style="color: var(--text-tertiary);">@now.ToString("MMMM yyyy")</small>
                        </div>
                    </div>
                    @if (budget.IsOverBudget)
                    {
                        <span class="badge badge-danger">
                            <i class="fas fa-exclamation-triangle"></i> Over Budget
                        </span>
                    }
                    else if (budget.IsNearLimit)
                    {
                        <span class="badge badge-warning">
                            <i class="fas fa-exclamation-circle"></i> Near Limit
                        </span>
                    }
                    else
                    {
                        <span class="badge badge-success">
                            <i class="fas fa-check-circle"></i> On Track
                        </span>
                    }
                </div>

                <div class="mb-3">
                    <div class="flex justify-between mb-2">
                        <span style="font-weight: 600; font-size: 1.5rem; color: @(budget.IsOverBudget ? "#ef4444" : "var(--text-primary)");">
                            @budget.SpentAmount.ToString("C")
                        </span>
                        <span style="color: var(--text-secondary);">of @budget.BudgetAmount.ToString("C")</span>
                    </div>
                    
                    <div style="background: var(--bg-secondary); height: 12px; border-radius: 999px; overflow: hidden;">
                        <div style="background: @(budget.IsOverBudget ? "#ef4444" : budget.IsNearLimit ? "#f59e0b" : "#10b981"); 
                                    height: 100%; 
                                    width: @Math.Min(budget.PercentageUsed, 100).ToString("F1")%; 
                                    transition: width 0.5s;"></div>
                    </div>
                    
                    <div class="flex justify-between mt-2">
                        <small style="color: var(--text-tertiary);">@budget.PercentageUsed.ToString("F1")% used</small>
                        <small style="color: @(budget.RemainingAmount >= 0 ? "#10b981" : "#ef4444"); font-weight: 500;">
                            @Math.Abs(budget.RemainingAmount).ToString("C") @(budget.RemainingAmount >= 0 ? "remaining" : "over")
                        </small>
                    </div>
                </div>

                <div class="flex gap-sm">
                    <a href="/Expenses?category=@budget.CategoryName" class="btn btn-sm btn-secondary flex-1">
                        <i class="fas fa-list"></i> View Expenses
                    </a>
                </div>
            </div>
        }
    </div>
}
else
{
    <div class="card text-center" style="padding: 3rem;">
        <i class="fas fa-piggy-bank fa-3x mb-3" style="color: var(--text-tertiary);"></i>
        <h3>No Budgets Set</h3>
        <p style="color: var(--text-secondary); margin-bottom: 1.5rem;">Start managing your finances by creating your first budget</p>
        <a href="/Budgets/Create" class="btn btn-primary">
            <i class="fas fa-plus"></i>
            Create Your First Budget
        </a>
    </div>
}
