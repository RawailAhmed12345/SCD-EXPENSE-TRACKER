@model ExpenseTracker.Models.ExpenseIndexViewModel

@{
    ViewData["Title"] = "Expenses";
    var categories = ViewBag.Categories as List<ExpenseTracker.Models.Category> ?? new List<ExpenseTracker.Models.Category>();
}

<!-- Page Header -->
<div class="flex justify-between items-center mb-4">
    <div>
        <h1 class="mb-1">Expenses</h1>
        <p style="color: var(--text-secondary);">Track and manage all your expenses</p>
    </div>
    <a href="/Expenses/Create" class="btn btn-primary">
        <i class="fas fa-plus"></i>
        Add Expense
    </a>
</div>

<!-- Summary Cards -->
<div class="grid grid-cols-3 gap-md mb-4">
    <div class="card card-gradient">
        <div class="flex justify-between items-center">
            <div>
                <p style="opacity: 0.9; margin-bottom: 0.5rem;">Total</p>
                <h2 style="margin: 0; color: white;">@Model.TotalAmount.ToString("C")</h2>
            </div>
            <i class="fas fa-wallet fa-2x" style="opacity: 0.5;"></i>
        </div>
    </div>

    <div class="card">
        <div class="flex justify-between items-center">
            <div>
                <p style="color: var(--text-secondary); margin-bottom: 0.5rem;">This Month</p>
                <h2 style="margin: 0;">@Model.MonthAmount.ToString("C")</h2>
            </div>
            <i class="fas fa-calendar-alt fa-2x" style="color: var(--primary-500);"></i>
        </div>
    </div>

    <div class="card">
        <div class="flex justify-between items-center">
            <div>
                <p style="color: var(--text-secondary); margin-bottom: 0.5rem;">Count</p>
                <h2 style="margin: 0;">@Model.Expenses.Count()</h2>
            </div>
            <i class="fas fa-receipt fa-2x" style="color: #10b981;"></i>
        </div>
    </div>
</div>

<!-- Filters -->
<div class="card mb-4">
    <form method="get" asp-action="Index">
        <div class="grid grid-cols-4 gap-md">
            <div class="form-group" style="margin-bottom: 0;">
                <label class="form-label">Search</label>
                <input class="form-control" type="text" name="q" placeholder="Search description..." value="@Model.Query" />
            </div>

            <div class="form-group" style="margin-bottom: 0;">
                <label class="form-label">Category</label>
                <select class="form-control" name="category">
                    <option value="">All Categories</option>
                    @foreach (var cat in categories)
                    {
                        <option value="@cat.Name" selected="@(Model.Category == cat.Name)">@cat.Name</option>
                    }
                </select>
            </div>

            <div class="form-group" style="margin-bottom: 0;">
                <label class="form-label">Start Date</label>
                <input class="form-control" type="date" name="startDate" value="@(Model.StartDate?.ToString("yyyy-MM-dd"))" />
            </div>

            <div class="form-group" style="margin-bottom: 0;">
                <label class="form-label">End Date</label>
                <input class="form-control" type="date" name="endDate" value="@(Model.EndDate?.ToString("yyyy-MM-dd"))" />
            </div>
        </div>

        <div class="flex gap-md mt-3">
            <button type="submit" class="btn btn-primary">
                <i class="fas fa-filter"></i> Apply Filters
            </button>
            <a class="btn btn-secondary" asp-action="Index">
                <i class="fas fa-times"></i> Clear
            </a>
        </div>
    </form>
</div>

<!-- Expenses Table -->
@if (Model.Expenses.Any())
{
    <div class="table-container">
        <table class="table">
            <thead>
                <tr>
                    <th>Date</th>
                    <th>Category</th>
                    <th>Description</th>
                    <th style="text-align: right;">Amount</th>
                    <th style="text-align: right;">Actions</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var expense in Model.Expenses)
                {
                    <tr>
                        <td>@expense.Date.ToString("MMM dd, yyyy")</td>
                        <td>
                            <div class="flex items-center gap-sm">
                                <i class="fas @(expense.CategoryNavigation?.Icon ?? "fa-circle")" 
                                   style="color: @(expense.CategoryNavigation?.Color ?? "#64748b");"></i>
                                <span>@(expense.CategoryNavigation?.Name ?? expense.Category ?? "Uncategorized")</span>
                            </div>
                        </td>
                        <td>@(expense.Description ?? "-")</td>
                        <td style="text-align: right; font-weight: 600; color: #ef4444;">
                            -@expense.Amount.ToString("C")
                        </td>
                        <td style="text-align: right;">
                            <div class="flex gap-sm justify-end">
                                <a class="btn btn-sm btn-secondary" asp-action="Details" asp-route-id="@expense.Id">
                                    <i class="fas fa-eye"></i>
                                </a>
                                <a class="btn btn-sm btn-secondary" asp-action="Edit" asp-route-id="@expense.Id">
                                    <i class="fas fa-edit"></i>
                                </a>
                                <form asp-action="Delete" asp-route-id="@expense.Id" method="post" style="display: inline;" onsubmit="return confirm('Delete this expense?');">
                                    @Html.AntiForgeryToken()
                                    <button type="submit" class="btn btn-sm btn-danger">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </form>
                            </div>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
}
else
{
    <div class="card text-center" style="padding: 3rem;">
        <i class="fas fa-receipt fa-3x mb-3" style="color: var(--text-tertiary);"></i>
        <h3>No Expenses Found</h3>
        <p style="color: var(--text-secondary); margin-bottom: 1.5rem;">
            @if (!string.IsNullOrEmpty(Model.Query) || !string.IsNullOrEmpty(Model.Category) || Model.StartDate.HasValue || Model.EndDate.HasValue)
            {
                <text>Try adjusting your filters or</text>
            }
            else
            {
                <text>Start tracking your expenses by adding your first one</text>
            }
        </p>
        <a href="/Expenses/Create" class="btn btn-primary">
            <i class="fas fa-plus"></i>
            Add Your First Expense
        </a>
    </div>
}