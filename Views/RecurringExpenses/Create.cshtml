@model ExpenseTracker.Models.RecurringExpense

@{
    ViewData["Title"] = "Create Recurring Expense";
    var categories = ViewBag.Categories as List<ExpenseTracker.Models.Category>;
}

<div class="mb-4">
    <h1>Create Recurring Expense</h1>
    <p style="color: var(--text-secondary);">Set up an automatic recurring expense</p>
</div>

<div class="card" style="max-width: 700px;">
    <form asp-action="Create" method="post">
        <div class="form-group">
            <label asp-for="CategoryId" class="form-label">Category</label>
            <select asp-for="CategoryId" class="form-control" required>
                <option value="">Select a category...</option>
                @if (categories != null)
                {
                    @foreach (var category in categories)
                    {
                        <option value="@category.Id">@category.Name</option>
                    }
                }
            </select>
            <span asp-validation-for="CategoryId" class="form-error"></span>
        </div>

        <div class="form-group">
            <label asp-for="Description" class="form-label">Description</label>
            <input asp-for="Description" class="form-control" placeholder="e.g., Netflix Subscription" required />
            <span asp-validation-for="Description" class="form-error"></span>
        </div>

        <div class="grid grid-cols-2 gap-md">
            <div class="form-group">
                <label asp-for="Amount" class="form-label">Amount</label>
                <input asp-for="Amount" class="form-control" type="number" step="0.01" min="0" required />
                <span asp-validation-for="Amount" class="form-error"></span>
            </div>

            <div class="form-group">
                <label asp-for="Frequency" class="form-label">Frequency</label>
                <select asp-for="Frequency" class="form-control" required id="frequencySelect">
                    <option value="Daily">Daily</option>
                    <option value="Weekly">Weekly</option>
                    <option value="Monthly" selected>Monthly</option>
                    <option value="Yearly">Yearly</option>
                </select>
                <span asp-validation-for="Frequency" class="form-error"></span>
            </div>
        </div>

        <div class="grid grid-cols-2 gap-md" id="dayOfMonthGroup" style="display: grid;">
            <div class="form-group">
                <label asp-for="DayOfMonth" class="form-label">Day of Month</label>
                <input asp-for="DayOfMonth" class="form-control" type="number" min="1" max="31" value="1" />
                <small style="color: var(--text-tertiary);">For monthly frequency</small>
                <span asp-validation-for="DayOfMonth" class="form-error"></span>
            </div>

            <div class="form-group" id="dayOfWeekGroup" style="display: none;">
                <label asp-for="DayOfWeek" class="form-label">Day of Week</label>
                <select asp-for="DayOfWeek" class="form-control">
                    <option value="Monday">Monday</option>
                    <option value="Tuesday">Tuesday</option>
                    <option value="Wednesday">Wednesday</option>
                    <option value="Thursday">Thursday</option>
                    <option value="Friday">Friday</option>
                    <option value="Saturday">Saturday</option>
                    <option value="Sunday">Sunday</option>
                </select>
                <small style="color: var(--text-tertiary);">For weekly frequency</small>
                <span asp-validation-for="DayOfWeek" class="form-error"></span>
            </div>
        </div>

        <div class="grid grid-cols-2 gap-md">
            <div class="form-group">
                <label asp-for="StartDate" class="form-label">Start Date</label>
                <input asp-for="StartDate" class="form-control" type="date" required />
                <span asp-validation-for="StartDate" class="form-error"></span>
            </div>

            <div class="form-group">
                <label asp-for="EndDate" class="form-label">End Date (Optional)</label>
                <input asp-for="EndDate" class="form-control" type="date" />
                <span asp-validation-for="EndDate" class="form-error"></span>
            </div>
        </div>

        <div class="flex gap-md mt-4">
            <button type="submit" class="btn btn-primary">
                <i class="fas fa-save"></i>
                Create Recurring Expense
            </button>
            <a asp-action="Index" class="btn btn-secondary">Cancel</a>
        </div>
    </form>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script>
        // Show/hide day fields based on frequency
        const frequencySelect = document.getElementById('frequencySelect');
        const dayOfMonthGroup = document.getElementById('dayOfMonthGroup');
        const dayOfWeekGroup = document.getElementById('dayOfWeekGroup');

        frequencySelect.addEventListener('change', function() {
            const frequency = this.value;
            
            if (frequency === 'Monthly') {
                dayOfMonthGroup.style.display = 'block';
                dayOfWeekGroup.style.display = 'none';
            } else if (frequency === 'Weekly') {
                dayOfMonthGroup.style.display = 'none';
                dayOfWeekGroup.style.display = 'block';
            } else {
                dayOfMonthGroup.style.display = 'none';
                dayOfWeekGroup.style.display = 'none';
            }
        });
    </script>
}
